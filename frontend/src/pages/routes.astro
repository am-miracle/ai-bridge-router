---
import MainLayout from "../layouts/main.astro";
import { HeroSection } from "@/components/HeroSection";
import { RouteQuoteForm } from "@/components/RouteQuoteForm";
import { ResultsSection } from "@/components/ResultsSection";
import { EmptyState } from "@/components/EmptyState";
import { actions, isInputError } from "astro:actions";
import { supportedChains, commonTokens } from "@/config/chains";

const content = {
  title: "Find Bridge Routes - Bridge Router",
};

// Get action result from form submission
const result = Astro.getActionResult(actions.getRouteQuote);
const inputErrors = isInputError(result?.error) ? result.error.fields : {};
const actionError = result?.error && !isInputError(result.error) ? result.error : undefined;
---

<MainLayout content={content}>
  <div class="max-w-6xl mx-auto space-y-8">
    <HeroSection
      title="Find the Best Bridge Route"
      description="Compare routes across multiple bridges to get the best rates, fastest times, and highest security."
      client:only="react"
    />

    {/* Quote Form */}
    <RouteQuoteForm
      supportedChains={supportedChains}
      commonTokens={commonTokens}
      initialErrors={inputErrors}
      actionError={actionError}
      actionUrl={actions.getRouteQuote.toString()}
      client:only="react"
    />

    {/* Results Section */}
    {
      result && !result.error && result.data && (
        <ResultsSection
          routes={result.data.routes}
          amount={result.data.amount}
          sourceChain={result.data.sourceChain}
          destinationChain={result.data.destinationChain}
          client:only="react"
        />
      )
    }

    {!result && <EmptyState client:only="react" />}
  </div>
</MainLayout>
